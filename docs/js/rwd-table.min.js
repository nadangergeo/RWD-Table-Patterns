/*!
 * Responsive Tables v5.0.1 (http://gergeo.se/RWD-Table-Patterns)
 * This is an awesome solution for responsive tables with complex data.
 * Authors: Nadan Gergeo <nadan.gergeo@gmail.com> (www.gergeo.se) & Maggie Wachs (www.filamentgroup.com)
 * Licensed under MIT (https://github.com/nadangergeo/RWD-Table-Patterns/blob/master/LICENSE-MIT)
 */
(function(e){"use strict";function r(){return typeof window.matchMedia!=="undefined"||typeof window.msMatchMedia!=="undefined"||typeof window.styleMedia!=="undefined"}function i(){return"ontouchstart"in window}function s(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))}var t=function(t,n){var r=this;this.options=n;this.$tableWrapper=null;this.$tableScrollWrapper=e(t);this.$table=e(t).find("table");if(this.$table.length!==1){throw new Error("Exactly one table is expected in a .table-responsive div.")}this.$tableScrollWrapper.attr("data-pattern",this.options.pattern);this.id=this.$table.prop("id")||this.$tableScrollWrapper.prop("id")||"id"+Math.random().toString(16).slice(2);this.$tableClone=null;this.$stickyTableHeader=null;this.$stickyLeftTableHeader=null;this.$thead=this.$table.find("thead");this.$tbody=this.$table.find("tbody");this.$hdrCells=this.$thead.find("th");this.$bodyRows=this.$tbody.find("tr");this.$btnToolbar=null;this.$dropdownGroup=null;this.$dropdownBtn=null;this.$dropdownContainer=null;this.$displayAllBtn=null;this.$focusGroup=null;this.$focusBtn=null;this.displayAllTrigger="display-all-"+this.id+".responsive-table";this.idPrefix=this.id+"-col-";this.iOS=s();this.wrapTable();this.createButtonToolbar();this.setupHdrCells();this.setupStandardCells();if(this.options.stickyTableHeader){this.createStickyTableHeader()}if(this.options.stickyLeftTableHeader){this.createStickyLeftTableHeader()}if(this.$dropdownContainer.is(":empty")){this.$dropdownGroup.hide()}e(window).bind("orientationchange resize "+this.displayAllTrigger,function(){r.$dropdownContainer.find("input").trigger("updateCheck");e.proxy(r.updateSpanningCells(),r)})};t.DEFAULTS={pattern:"priority-columns",stickyTableHeader:true,stickyLeftTableHeader:false,fixedNavbar:".navbar-fixed-top",addDisplayAllBtn:true,addFocusBtn:true,focusBtnIcon:"glyphicon glyphicon-screenshot"};t.prototype.wrapTable=function(){this.$tableScrollWrapper.wrap('<div class="table-wrapper"/>');this.$tableWrapper=this.$tableScrollWrapper.parent()};t.prototype.createButtonToolbar=function(){var t=this;this.$btnToolbar=e('<div class="btn-toolbar" />');this.$dropdownGroup=e('<div class="btn-group dropdown-btn-group pull-right" />');this.$dropdownBtn=e('<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">Display <span class="caret"></span></button>');this.$dropdownContainer=e('<ul class="dropdown-menu"/>');if(this.options.addFocusBtn){this.$focusGroup=e('<div class="btn-group focus-btn-group" />');this.$focusBtn=e('<button class="btn btn-default">Focus</button>');if(this.options.focusBtnIcon){this.$focusBtn.prepend('<span class="'+this.options.focusBtnIcon+'"></span> ')}this.$focusGroup.append(this.$focusBtn);this.$btnToolbar.append(this.$focusGroup);this.$focusBtn.click(function(){e.proxy(t.activateFocus(),t)});this.$bodyRows.click(function(){e.proxy(t.focusOnRow(e(this)),t)})}if(this.options.addDisplayAllBtn){this.$displayAllBtn=e('<button class="btn btn-default">Display all</button>');this.$dropdownGroup.append(this.$displayAllBtn);if(this.$table.hasClass("display-all")){this.$displayAllBtn.addClass("btn-primary")}this.$displayAllBtn.click(function(){e.proxy(t.displayAll(null,true),t)})}this.$dropdownGroup.append(this.$dropdownBtn).append(this.$dropdownContainer);this.$btnToolbar.append(this.$dropdownGroup);this.$tableScrollWrapper.before(this.$btnToolbar)};t.prototype.clearAllFocus=function(){this.$bodyRows.removeClass("unfocused");this.$bodyRows.removeClass("focused")};t.prototype.activateFocus=function(){this.clearAllFocus();if(this.$focusBtn){this.$focusBtn.toggleClass("btn-primary")}this.$table.toggleClass("focus-on")};t.prototype.focusOnRow=function(t){if(this.$table.hasClass("focus-on")){var n=e(t).hasClass("focused");this.clearAllFocus();if(!n){this.$bodyRows.addClass("unfocused");e(t).addClass("focused")}}};t.prototype.displayAll=function(t,n){if(this.$displayAllBtn){this.$displayAllBtn.toggleClass("btn-primary",t)}this.$table.toggleClass("display-all",t);if(this.$tableClone){this.$tableClone.toggleClass("display-all",t)}if(n){e(window).trigger(this.displayAllTrigger)}};t.prototype.preserveDisplayAll=function(){var t="table-cell";if(e("html").hasClass("lt-ie9")){t="inline"}e(this.$table).find("th, td").css("display",t);if(this.$tableClone){e(this.$tableClone).find("th, td").css("display",t)}};t.prototype.createStickyTableHeader=function(){var t=this;t.$tableClone=t.$table.clone();t.$tableClone.prop("id",this.id+"-clone");t.$tableClone.find("[id]").each(function(){e(this).prop("id",e(this).prop("id")+"-clone")});t.$tableClone.wrap('<div class="sticky-table-header"/>');t.$stickyTableHeader=t.$tableClone.parent();t.$stickyTableHeader.css("height",t.$thead.height()+2);if(e("html").hasClass("lt-ie10")){t.$tableWrapper.prepend(t.$stickyTableHeader)}else{t.$table.before(t.$stickyTableHeader)}e(window).bind("scroll resize",function(){e.proxy(t.updateStickyTableHeader(),t)});e(t.$tableScrollWrapper).bind("scroll",function(){e.proxy(t.updateStickyTableHeader(),t)})};t.prototype.createStickyLeftTableHeader=function(){var e=this.$tableWrapper.clone().find("table");this.$table.addClass("sticky-left-header");e.find("td:not(:first-child), th:not(:first-child)").remove();this.$tableWrapper.append(e);e.wrap("<div class='pinned' />");this.$table.wrap('<div class="scrollable" />')};t.prototype.updateStickyTableHeader=function(){var t=this,n=0,r=t.$table.offset().top,i=e(window).scrollTop()-1,s=t.$table.height()-t.$stickyTableHeader.height(),o=i+e(window).height()-e(document).height(),u=!t.iOS,a=0;if(e(t.options.fixedNavbar).length){var f=e(t.options.fixedNavbar).first();a=f.height();i=i+a}var l=i>r&&i<r+t.$table.height();if(u){t.$stickyTableHeader.scrollLeft(t.$tableScrollWrapper.scrollLeft());t.$stickyTableHeader.addClass("fixed-solution");n=a-1;if(i-r>s){n-=i-r-s;t.$stickyTableHeader.addClass("border-radius-fix")}else{t.$stickyTableHeader.removeClass("border-radius-fix")}if(l){t.$stickyTableHeader.css({visibility:"visible",top:n+"px",width:t.$tableScrollWrapper.innerWidth()+"px"});return}else{t.$stickyTableHeader.css({visibility:"hidden",width:"auto"})}}else{t.$stickyTableHeader.removeClass("fixed-solution");var c=400;n=i-r-1;if(n<0){n=0}else if(n>s){n=s}if(o>0){n=n-o}if(l){t.$stickyTableHeader.css({visibility:"visible"});t.$stickyTableHeader.animate({top:n+"px"},c);t.$thead.css({visibility:"hidden"})}else{t.$stickyTableHeader.animate({top:"0"},c,function(){t.$thead.css({visibility:"visible"});t.$stickyTableHeader.css({visibility:"hidden"})})}}};t.prototype.setupHdrCells=function(){var t=this;t.$hdrCells.each(function(n){var r=e(this),i=r.prop("id"),s=r.text();if(!i){i=t.idPrefix+n;r.prop("id",i)}if(s===""){s=r.attr("data-col-name")}if(r.is("[data-priority]")){var o=e('<li class="checkbox-row"><input type="checkbox" name="toggle-'+i+'" id="toggle-'+i+'" value="'+i+'" /> <label for="toggle-'+i+'">'+s+"</label></li>");var u=o.find("input");t.$dropdownContainer.append(o);o.click(function(){u.prop("checked",!u.prop("checked"));u.trigger("change")});if(e("html").hasClass("lt-ie9")){u.click(function(){e(this).trigger("change")})}o.find("label").click(function(e){e.stopPropagation()});o.find("input").click(function(e){e.stopPropagation()}).change(function(){var n=e(this),r=n.val(),i=t.$tableScrollWrapper.find("#"+r+", #"+r+"-clone, [data-columns~="+r+"]");if(t.$table.hasClass("display-all")){e.proxy(t.preserveDisplayAll(),t);t.$table.removeClass("display-all");if(t.$tableClone){t.$tableClone.removeClass("display-all")}t.$displayAllBtn.removeClass("btn-primary")}i.each(function(){var t=e(this);if(n.is(":checked")){if(t.css("display")!=="none"){t.prop("colSpan",parseInt(t.prop("colSpan"))+1)}t.show()}else{if(parseInt(t.prop("colSpan"))>1){t.prop("colSpan",parseInt(t.prop("colSpan"))-1)}else{t.hide()}}})}).bind("updateCheck",function(){if(r.css("display")!=="none"){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}).trigger("updateCheck")}})};t.prototype.setupStandardCells=function(){var t=this;t.$bodyRows.each(function(){var n=0;e(this).find("th, td").each(function(){var r=e(this);var i="";var s=r.prop("colSpan");var o=0;for(var u=n;u<n+s;u++){i=i+" "+t.idPrefix+u;var a=t.$tableScrollWrapper.find("#"+t.idPrefix+u);var f=a.attr("data-priority");if(f){r.attr("data-priority",f)}if(a.css("display")==="none"){o++}}if(s>1){r.addClass("spn-cell");if(o!==s){r.show()}else{r.hide()}}r.prop("colSpan",Math.max(s-o,1));i=i.substring(1);r.attr("data-columns",i);n=n+s})})};t.prototype.updateSpanningCells=function(){var t=this;t.$table.find(".spn-cell").each(function(){var t=e(this);var n=t.attr("data-columns").split(" ");var r=n.length;var i=0;for(var s=0;s<r;s++){if(e("#"+n[s]).css("display")==="none"){i++}}if(i!==r){t.show()}else{t.hide()}t.prop("colSpan",Math.max(r-i,1))})};var n=e.fn.responsiveTable;e.fn.responsiveTable=function(n){return this.each(function(){var r=e(this);var i=r.data("responsiveTable");var s=e.extend({},t.DEFAULTS,r.data(),typeof n==="object"&&n);if(s.pattern===""){return}if(!i){r.data("responsiveTable",i=new t(this,s))}if(typeof n==="string"){i[n]()}})};e.fn.responsiveTable.Constructor=t;e.fn.responsiveTable.noConflict=function(){e.fn.responsiveTable=n;return this};e(document).on("ready.responsive-table.data-api",function(){e("[data-pattern]").each(function(){var t=e(this);t.responsiveTable(t.data())})});e(document).on("click.dropdown.data-api",".dropdown-menu .checkbox-row",function(e){e.stopPropagation()});e(document).ready(function(){e("html").removeClass("no-js").addClass("js");if(r()){e("html").addClass("mq")}else{e("html").addClass("no-mq")}if(i()){e("html").addClass("touch")}else{e("html").addClass("no-touch")}})})(jQuery)
